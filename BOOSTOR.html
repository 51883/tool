<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOOSTORä¸€ä½“æŠŠå®‰è£…æ£€æµ‹å·¥å…·</title>
    <style>
        :root {
            --brand-color: #000;
            --bg-color: #f3f4f6;
            --danger-bg: #fee2e2;
            --danger-text: #991b1b;
            --warning-bg: #ffedd5;
            --warning-text: #9a3412;
            --success-bg: #dcfce7;
            --success-text: #166534;
        }

        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg-color); padding: 20px; line-height: 1.5; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        
        h1 { text-align: center; margin-bottom: 5px; }
        .sub-header { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 30px; }

        /* ä¸¤æ å¸ƒå±€ */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px; }
        @media(max-width: 768px) { .grid-2 { grid-template-columns: 1fr; } }

        .panel { padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb; }
        .panel-title { font-weight: bold; border-bottom: 2px solid #eee; padding-bottom: 8px; margin-bottom: 15px; display: block; }
        
        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.85rem; color: #4b5563; font-weight: 600; margin-bottom: 4px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; box-sizing: border-box; }
        input:focus, select:focus { outline: 2px solid var(--brand-color); border-color: transparent; }

        /* é”å®šçš„è¾“å…¥æ¡†æ ·å¼ */
        input.locked { background-color: #f3f4f6; color: #6b7280; cursor: not-allowed; border-color: #e5e7eb; }

        /* è­¦å‘Šæ¡†æ ¸å¿ƒæ ·å¼ */
        .alert-box { 
            padding: 15px; border-radius: 8px; margin-top: 20px; 
            border-left: 5px solid #ccc; display: none; 
        }
        .alert-danger { background: var(--danger-bg); color: var(--danger-text); border-left-color: #ef4444; }
        .alert-warning { background: var(--warning-bg); color: var(--warning-text); border-left-color: #f97316; }
        .alert-success { background: var(--success-bg); color: var(--success-text); border-left-color: #22c55e; }

        .badge { display: inline-block; padding: 2px 6px; background: #000; color: #fff; font-size: 0.7em; border-radius: 4px; vertical-align: middle; margin-left: 5px; }

        canvas { width: 100%; background: #fff; height: 350px; border-radius: 8px; margin-top: 20px; border: 1px solid #eee; }
    </style>
</head>
<body>

<div class="container">
    <h1>BOOSTORä¸€ä½“æŠŠé€‰è´­ & å‡ ä½•æ£€æµ‹</h1>
    <div class="sub-header">âš ï¸ è´­ä¹°å‰è¯·åŠ¡å¿…ç¡®è®¤å‰å‰é¢„ç•™é•¿åº¦ï¼Œé¿å…æ— æ³•å®‰è£…</div>

    <div class="grid-2">
        <div class="panel">
            <span class="panel-title">ğŸš² æ‚¨ç°åœ¨çš„è®¾ç½® (Old)</span>
            
            <div class="input-group">
                <label>åŸè½¦æŠŠ Reach (mm)</label>
                <input type="number" id="oldReach" value="80">
            </div>
            <div class="input-group">
                <label>åŸæŠŠç«‹é•¿åº¦ (mm)</label>
                <input type="number" id="oldStemLen" value="100">
            </div>
            <div class="input-group">
                <label>åŸæŠŠç«‹è§’åº¦ (ä¾‹å¦‚ -6 æˆ– -7)</label>
                <input type="number" id="oldStemAng" value="-6">
            </div>
            <div class="input-group">
                <label>å½“å‰å«åœˆé«˜åº¦ (mm) <span style="color:red">*</span></label>
                <input type="number" id="oldSpacer" value="20" placeholder="éå¸¸é‡è¦">
            </div>
            <div class="input-group">
                <label>è½¦æ¶å¤´ç®¡è§’åº¦ (HTA)</label>
                <input type="number" id="hta" value="73">
            </div>
        </div>

        <div class="panel" style="border-color: #000;">
            <span class="panel-title">ğŸ›’ é€‰æ‹©æˆ‘ä»¬çš„äº§å“ (New)</span>
            
            <div class="input-group">
                <label>é€‰æ‹©ä¸€ä½“æŠŠè§„æ ¼ï¼š</label>
                <select id="productSelect" style="font-weight:bold; border: 2px solid #000;"></select>
            </div>

            <div style="background: #f8fafc; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-size: 0.9em; color: #666;">
                <div id="productSpecs">è¯·é€‰æ‹©è§„æ ¼...</div>
            </div>

            <div class="grid-2" style="gap:10px; margin-bottom: 0;">
                <div>
                    <label>æ–°æŠŠç«‹é•¿åº¦ <span class="badge">å›ºå®š</span></label>
                    <input type="number" id="newStemLen" class="locked" readonly>
                </div>
                <div>
                    <label>æ–°æŠŠç«‹è§’åº¦ <span class="badge">å›ºå®š</span></label>
                    <input type="number" id="newStemAng" class="locked" readonly>
                </div>
            </div>

            <hr style="border: 0; border-top: 1px dashed #ccc; margin: 15px 0;">

            <div class="input-group">
                <label style="color: #d97706;">ğŸ”§ æ¨¡æ‹Ÿè°ƒæ•´ï¼šæ–°å«åœˆé«˜åº¦ (mm)</label>
                <input type="number" id="newSpacer" value="20" style="border: 2px solid #d97706;">
                <div style="font-size: 0.8em; color: #888; margin-top: 4px;">è¯•ç€ä¿®æ”¹è¿™ä¸ªæ•°å€¼ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ‰¾å›åŸæ¥çš„å§¿æ€ã€‚</div>
            </div>
        </div>
    </div>

    <div id="reportCard" class="alert-box">
        <h3 style="margin:0 0 10px 0;">ğŸ“Š æ£€æµ‹æŠ¥å‘Š</h3>
        <div id="reportContent"></div>
    </div>

    <canvas id="simCanvas" width="800" height="400"></canvas>
</div>

<script>
    // â–¼â–¼â–¼â–¼â–¼â–¼ æ ¸å¿ƒé…ç½®åŒº (ä¸€ä½“æŠŠæ•°æ®) â–¼â–¼â–¼â–¼â–¼â–¼
    // å¯¹äºä¸€ä½“æŠŠï¼Œä½ éœ€è¦æŠŠæ¯ä¸ªå°ºå¯¸çš„ Reach/StemLength/StemAngle éƒ½å½•å…¥
    // é€šå¸¸ä¸€ä½“æŠŠçš„ Reach å’Œ Angle æ˜¯å…¨ç³»å›ºå®šçš„ï¼Œåªæœ‰ StemLength å˜åŒ–ï¼Œä½†ä¹Ÿæœ‰ç‰¹ä¾‹
    const myProducts = [
        { name: "-- è¯·é€‰æ‹©å°ºå¯¸ --", value: "none" },
        
        // ä½ çš„äº§å“åˆ—è¡¨
        { name: "90mm x 400mm", stemLen: 90, stemAng: -10, reach: 75, rise: 0 },
        { name: "100mm x 400mm", stemLen: 100, stemAng: -10, reach: 75, rise: 0 },
        { name: "110mm x 400mm", stemLen: 110, stemAng: -10, reach: 75, rise: 0 },
        { name: "120mm x 400mm", stemLen: 120, stemAng: -10, reach: 75, rise: 0 },
        
        // å¦‚æœæœ‰ç‰¹åˆ«æ¿€è¿›çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ -15åº¦
        { name: "Pro Team 100mm (-15Â°)", stemLen: 100, stemAng: -15, reach: 80, rise: 0 },
    ];
    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    const dom = {
        select: document.getElementById('productSelect'),
        specs: document.getElementById('productSpecs'),
        newStemLen: document.getElementById('newStemLen'),
        newStemAng: document.getElementById('newStemAng'),
        newSpacer: document.getElementById('newSpacer'),
        report: document.getElementById('reportCard'),
        reportContent: document.getElementById('reportContent'),
        inputs: document.querySelectorAll('input')
    };

    let selectedProduct = null;

    // åˆå§‹åŒ–
    function init() {
        myProducts.forEach((p, i) => {
            const opt = document.createElement('option');
            opt.text = p.name;
            opt.value = i;
            dom.select.add(opt);
        });

        dom.select.addEventListener('change', onSelect);
        dom.inputs.forEach(el => el.addEventListener('input', calculate));
        
        // é»˜è®¤ä¸è®¡ç®—ï¼Œç›´åˆ°é€‰æ‹©
        drawEmpty();
    }

    function onSelect(e) {
        const idx = e.target.value;
        const p = myProducts[idx];

        if (!p || p.value === 'none') {
            selectedProduct = null;
            dom.newStemLen.value = "";
            dom.newStemAng.value = "";
            dom.specs.innerHTML = "è¯·é€‰æ‹©è§„æ ¼...";
            dom.report.style.display = 'none';
            drawEmpty();
            return;
        }

        selectedProduct = p;
        // è‡ªåŠ¨å¡«å…¥é”å®šçš„æ•°æ®
        dom.newStemLen.value = p.stemLen;
        dom.newStemAng.value = p.stemAng;
        
        dom.specs.innerHTML = `
            <strong>å›ºå®šå‚æ•°ï¼š</strong> 
            Reach ${p.reach}mm | Rise ${p.rise}mm | è§’åº¦ ${p.stemAng}Â° | æŠŠç«‹ ${p.stemLen}mm
        `;

        calculate();
    }

    function calculate() {
        if (!selectedProduct) return;

        // è·å–æ—§æ•°æ®
        const hta = parseFloat(document.getElementById('hta').value);
        const oldSpacer = parseFloat(document.getElementById('oldSpacer').value);
        const oldStemLen = parseFloat(document.getElementById('oldStemLen').value);
        const oldStemAng = parseFloat(document.getElementById('oldStemAng').value);
        const oldReach = parseFloat(document.getElementById('oldReach').value);
        // è¿™é‡Œå‡è®¾æ—§è½¦æŠŠRiseä¸º0ï¼Œå¦‚æœæœ‰éœ€è¦ä¹Ÿå¯ä»¥åŠ ä¸Šè¾“å…¥æ¡†
        const oldRise = 0; 

        // è·å–æ–°æ•°æ® (ç”¨æˆ·åªèƒ½åŠ¨å«åœˆ)
        const newSpacer = parseFloat(dom.newSpacer.value);
        
        // è®¡ç®—åæ ‡
        const p1 = getCoordinates(oldSpacer, oldStemLen, oldStemAng, oldReach, oldRise, hta);
        const p2 = getCoordinates(newSpacer, selectedProduct.stemLen, selectedProduct.stemAng, selectedProduct.reach, selectedProduct.rise, hta);

        const dReach = p2.x - p1.x;
        const dStack = p2.y - p1.y;

        analyzeRisk(dReach, dStack, newSpacer, oldSpacer);
        draw(p1, p2, hta);
    }

    // é£é™©è¯„ä¼°é€»è¾‘ (æœ€å…³é”®çš„éƒ¨åˆ†)
    function analyzeRisk(dR, dS, newSpacer, oldSpacer) {
        dom.report.style.display = 'block';
        let html = "";
        let level = "success"; // success, warning, danger
        let issues = [];

        // 1. æ£€æŸ¥å‰å‰é•¿åº¦å±æœº (Fork Check)
        const spacerDiff = newSpacer - oldSpacer;
        if (spacerDiff > 5) {
            level = "danger";
            issues.push(`
                <div style="margin-bottom:10px;">
                    <strong>ğŸ›‘ ä¸¥é‡è­¦å‘Šï¼šå‰å‰é•¿åº¦é£é™©</strong><br>
                    æ‚¨åœ¨æ¨¡æ‹Ÿä¸­å¢åŠ äº† <b>${spacerDiff}mm</b> çš„å«åœˆã€‚<br>
                    <span style="color:#b91c1c">è¯·æ£€æŸ¥æ‚¨çš„çˆ±è½¦ï¼šæŠŠç«‹ä¸Šæ–¹è¿˜æœ‰å¤šä½™çš„èˆµç®¡å—ï¼Ÿ</span><br>
                    å¦‚æœæ‚¨çš„å‰å‰å·²ç»åˆ‡å¹³ï¼Œ<strong>æ— æ³•å®‰è£…æ­¤è®¾ç½®</strong>ï¼Œå› ä¸ºé«˜åº¦ä¸å¤Ÿã€‚
                </div>
            `);
        }

        // 2. æ£€æŸ¥ Stack éª¤é™ (Back Pain Check)
        if (dS < -15 && spacerDiff <= 0) {
            // å¦‚æœé«˜åº¦é™äº†å¾ˆå¤šï¼Œä¸”ç”¨æˆ·æ²¡åŠ å«åœˆ
            if(level !== 'danger') level = "warning";
            issues.push(`
                <div style="margin-bottom:10px;">
                    <strong>âš ï¸ é«˜åº¦æ˜¾è‘—é™ä½ (-${Math.abs(dS).toFixed(0)}mm)</strong><br>
                    æ–°çš„ä¸€ä½“æŠŠè§’åº¦è¾ƒæ¿€è¿›ï¼Œæ‚¨çš„è½¦å¤´ä¼šå¤§å¹…é™ä½ã€‚<br>
                    å¦‚æœæ‚¨çš„è…°éƒ¨æŸ”éŸ§æ€§ä¸€èˆ¬ï¼Œå»ºè®®åœ¨ä¸Šæ–¹â€œæ–°å«åœˆâ€æ å¢åŠ å«åœˆæ¥è¡¥å¿é«˜åº¦ã€‚
                </div>
            `);
        }

        // 3. æ£€æŸ¥ Reach æ‹‰ä¼¸
        if (dR > 15) {
            if(level !== 'danger') level = "warning";
            issues.push(`
                <div style="margin-bottom:10px;">
                    <strong>âš ï¸ èº«ä½“è¿‡åº¦æ‹‰ä¼¸ (+${dR.toFixed(0)}mm)</strong><br>
                    æŠŠç«‹è¿‡é•¿æˆ– Reach è¿‡å¤§ã€‚ç”±äºä¸€ä½“æŠŠæ— æ³•æ›´æ¢æŠŠç«‹ï¼Œè¯·æ…é‡è€ƒè™‘é€‰æ‹©æ›´çŸ­çš„å°ºå¯¸ï¼ˆå¦‚ ${selectedProduct.stemLen - 10}mmï¼‰ã€‚
                </div>
            `);
        }

        // 4. å®Œç¾åŒ¹é…
        if (issues.length === 0) {
            if (Math.abs(dR) < 5 && Math.abs(dS) < 5) {
                html = `<strong>âœ… å®Œç¾åŒ¹é…</strong><br>æ–°çš„è®¾ç½®ä¸æ‚¨å½“å‰çš„å‡ ä½•å‡ ä¹ä¸€è‡´ï¼Œå¯ç›´æ¥å®‰è£…ã€‚`;
            } else {
                html = `<strong>âœ… æ•°æ®å˜åŠ¨åœ¨åˆç†èŒƒå›´</strong><br>
                        Reach: ${(dR>0?"+":"")+dR.toFixed(1)}mm <br>
                        Stack: ${(dS>0?"+":"")+dS.toFixed(1)}mm`;
            }
        } else {
            html = issues.join("");
        }

        dom.report.className = "alert-box alert-" + level;
        dom.reportContent.innerHTML = html;
    }

    function getCoordinates(spacer, stemLen, stemAng, barReach, barRise, hta) {
        const htaRad = hta * Math.PI / 180;
        const spX = -1 * spacer * Math.cos(htaRad);
        const spY = spacer * Math.sin(htaRad);
        
        const stemAbsAng = ((hta - 90) + stemAng) * Math.PI / 180;
        const stX = stemLen * Math.cos(stemAbsAng);
        const stY = stemLen * Math.sin(stemAbsAng);
        
        return {
            x: spX + stX + barReach,
            y: spY + stY + barRise,
            spX, spY, stX, stY
        };
    }

    function draw(p1, p2, hta) {
        const ctx = document.getElementById('simCanvas').getContext('2d');
        const w = 800; const h = 400;
        ctx.clearRect(0,0,w,h);
        
        const scale = 2.5; const ox = 200; const oy = 350;
        const toC = (x,y) => ({x: ox + x*scale, y: oy - y*scale});

        // è¾…åŠ©çº¿
        ctx.strokeStyle="#eee"; ctx.beginPath(); ctx.moveTo(0,oy); ctx.lineTo(w,oy); ctx.stroke();

        function drawBike(p, color, style) {
            ctx.strokeStyle = color; ctx.lineWidth = style==='dash'?2:5;
            if(style==='dash') ctx.setLineDash([5,5]); else ctx.setLineDash([]);
            
            ctx.beginPath();
            ctx.moveTo(ox, oy); // ç¢—ç»„åº•
            const sp = toC(p.spX, p.spY);
            ctx.lineTo(sp.x, sp.y); // å«åœˆé¡¶
            const st = toC(p.spX+p.stX, p.spY+p.stY);
            ctx.lineTo(st.x, st.y); // æŠŠç«‹é¡¶
            const bar = toC(p.x, p.y);
            ctx.lineTo(bar.x, bar.y); // æŠ“æ¡ç‚¹
            ctx.stroke();

            // æŠ“æ¡ç‚¹åœ†åœˆ
            ctx.fillStyle = color; ctx.beginPath(); 
            ctx.arc(bar.x, bar.y, style==='dash'?4:6, 0, 6.28); ctx.fill();
        }

        drawBike(p1, "#9ca3af", "dash"); // æ—§
        drawBike(p2, "#000000", "solid"); // æ–°
        
        // å›¾ä¾‹
        ctx.font="14px sans-serif"; ctx.fillStyle="#666";
        ctx.fillText("â— ç°è‰²è™šçº¿: åŸè®¾ç½®", 80, 30);
        ctx.fillStyle="#000";
        ctx.fillText("â— é»‘è‰²å®çº¿: æ¨¡æ‹Ÿæ•ˆæœ", 87, 50);
    }

    function drawEmpty() {
        const ctx = document.getElementById('simCanvas').getContext('2d');
        ctx.clearRect(0,0,800,400);
        ctx.font = "20px sans-serif";
        ctx.fillStyle = "#ccc";
        ctx.textAlign = "center";
        ctx.fillText("è¯·åœ¨ä¸Šæ–¹é€‰æ‹©ä¸€ä¸ªå°ºå¯¸å¼€å§‹æ£€æµ‹", 400, 200);
    }

    init();
</script>
</body>
</html>
