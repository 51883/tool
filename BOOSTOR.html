<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>BOOSTOR Pro - Precision Geometry</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    /* === å…¨å±€æ ·å¼ === */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary: #0f172a;
      --accent: #3b82f6;
      --bg-body: #f8fafc;
      --bg-card: #ffffff;
      --text-main: #1e293b;
      --text-sub: #64748b;
      --border: #e2e8f0;
      --radius-input: 10px;
      --radius-card: 16px;
      --highlight: #f59e0b;
    }
    body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-main); padding: 30px 15px; line-height: 1.6; }
    .container { max-width: 960px; margin: 0 auto; }
    h1 { text-align: center; font-weight: 800; font-size: 2rem; color: var(--primary); margin-bottom: 5px; }
    .sub-header { text-align: center; color: var(--text-sub); margin-bottom: 40px; font-size: 0.95rem; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
    @media(max-width: 768px) { .grid-2 { grid-template-columns: 1fr; gap: 20px; } body { padding: 20px 10px; } }
    .panel { background: var(--bg-card); padding: 25px; border-radius: var(--radius-card); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid var(--border); }
    .panel-new { border-top: 4px solid var(--primary); }
    .panel-title { font-size: 1.1rem; font-weight: 700; color: var(--primary); margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
    .input-group { margin-bottom: 18px; width: 100%; }
    label { display: block; font-size: 0.75rem; text-transform: uppercase; color: var(--text-sub); font-weight: 600; margin-bottom: 6px; }
    input, select { width: 100%; padding: 12px 15px; font-size: 0.95rem; font-weight: 600; color: var(--primary); background: #fff; border: 1px solid var(--border); border-radius: var(--radius-input); }
    .locked-input { background-color: #f8fafc; color: #94a3b8; border-color: #f1f5f9; cursor: default; }
    .editable-input { background-color: #fff; border-color: #bfdbfe; }
    .spacer-input { border-color: #f59e0b; color: #b45309; background-color: #fffbeb; }
    .tag { display: inline-block; font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; margin-left: 6px; vertical-align: middle; }
    .tag-fix { background: #e2e8f0; color: #64748b; }
    .tag-edit { background: #dbeafe; color: #1e40af; }

    .canvas-container { display: none !important; position: relative; background: #fff; border-radius: var(--radius-card); border: 1px solid var(--border); padding: 10px; margin-top: 30px; overflow: hidden; display: none; }
    canvas { width: 100%; height: auto; display: block; }

    .alert-box { background: #fff; border-radius: var(--radius-card); padding: 25px; margin-top: 30px; display: none; border-left: 5px solid #ccc; }
    .alert-success { border-color: #10b981; background: #ecfdf5; }
    .alert-danger  { border-color: #ef4444; background: #fef2f2; }
    .alert-warning { border-color: #f59e0b; background: #fffbeb; }

    .metric-row { display: flex; justify-content: space-around; text-align: center; margin: 15px 0; padding: 20px 0; background: rgba(255,255,255,0.6); border-radius: 12px; border: 1px solid rgba(0,0,0,0.05); }
    .metric-val { font-size: 1.6rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; justify-content: center; gap: 5px; }
    .metric-lbl { font-size: 0.8rem; color: var(--text-sub); text-transform: uppercase; margin-top: 5px; font-weight: 600; }

    .explain-box { background: rgba(255,255,255,0.8); border-radius: 8px; padding: 15px; margin-top: 20px; border: 1px dashed #cbd5e1; font-size: 0.9rem; color: #475569; }
    .explain-title { font-weight: 700; margin-bottom: 8px; color: #334155; display: flex; align-items: center; gap: 6px; }

    details.math-details { margin-top: 20px; background: #f8fafc; border-radius: 8px; overflow: hidden; border: 1px solid #e2e8f0; }
    details.math-details summary { padding: 15px; font-weight: 600; cursor: pointer; color: #334155; font-size: 0.95rem; display: flex; justify-content: space-between; align-items: center; background: #f1f5f9; }
    details.math-details summary::after { content: "â–¼"; font-size: 0.8em; color: #64748b; }
    details[open].math-details summary::after { content: "â–²"; }
    .math-content { padding: 20px; font-size: 0.9rem; color: #334155; line-height: 1.8; background: #fff; }
    .math-block { margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px dashed #e2e8f0; }
    .math-block:last-child { border: none; margin: 0; padding: 0; }
    .math-h { font-weight: 700; color: #0f172a; margin-bottom: 8px; }

    .legend { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 8px; border: 1px solid #eee; font-size: 0.8rem; pointer-events: none; }
    .legend-item { display: flex; align-items: center; margin-bottom: 4px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 6px; }
  </style>
</head>

<body>
  <div class="container">
    <h1>BOOSTOR Pro</h1>
    <div class="sub-header">Fixed Rise å‡ ä½•åˆ†æç³»ç»Ÿ (V7.0)</div>

    <div class="grid-2">
      <div class="panel">
        <div class="panel-title">ğŸš² <span>åŸè½¦è®¾å®š (Old)</span></div>
        <div class="input-group"><label>Reach</label><input type="number" id="oldReach" value="80"></div>
        <div class="grid-2" style="margin-bottom:0; gap:15px;">
          <div class="input-group"><label>æŠŠç«‹é•¿åº¦</label><input type="number" id="oldStemLen" value="100"></div>
          <div class="input-group"><label>æŠŠç«‹è§’åº¦ (Â°)</label><input type="number" id="oldStemAng" value="-6" placeholder="-6"></div>
        </div>
        <div class="input-group"><label>å«åœˆé«˜åº¦ (Spacer)</label><input type="number" id="oldSpacer" value="20"></div>
        <div class="input-group"><label>å¤´ç®¡è§’åº¦ (HTA)</label><input type="number" id="hta" value="73"></div>
      </div>

      <div class="panel panel-new">
        <div class="panel-title">ğŸ›’ <span>ç›®æ ‡è®¾å®š (New)</span></div>
        <div class="input-group"><label>é€‰æ‹©å›ºå®šæŠ¬å‡(54mm)è§„æ ¼</label><select id="productSelect"></select></div>

        <div id="specDetail" style="background:#f8fafc; padding:12px; border-radius:8px; margin-bottom:20px; display:none;">
          <div style="font-size:0.85em; color:#64748b; margin-bottom:5px;">è§„æ ¼è¯¦æƒ…</div>
          <div id="specText" style="font-weight:700; color:#0f172a;"></div>
          <div style="font-size:0.75em; color:#059669; margin-top:4px;">âœ¨ Stack ç†è®ºå€¼: 54mm (at 73Â° HTA)</div>
        </div>

        <div class="grid-2" style="margin-bottom:0; gap:15px;">
          <div class="input-group">
            <label>ç‰©ç†é•¿åº¦ (Sloped) <span id="tagLen" class="tag tag-fix">å›ºå®š</span></label>
            <input type="number" id="newStemLen" class="locked-input" readonly>
          </div>
          <div class="input-group">
            <label>ç‰©ç†è§’åº¦ (Angle) <span id="tagAng" class="tag tag-fix">å›ºå®š</span></label>
            <input type="number" id="newStemAng" class="locked-input" readonly>
          </div>
        </div>

        <div class="input-group">
          <label>æ–°è½¦æŠŠ Reach <span id="tagReach" class="tag tag-fix">å›ºå®š</span></label>
          <input type="number" id="newReach" class="locked-input" readonly>
        </div>

        <input type="hidden" id="newRise">
        <div class="input-group" style="margin-top:20px;">
          <label style="color:var(--highlight);">ğŸ”§ æ¨¡æ‹Ÿè°ƒæ•´ï¼šå«åœˆé«˜åº¦ (mm)</label>
          <input type="number" id="newSpacer" value="20" class="spacer-input">
        </div>
      </div>
    </div>

    <div id="reportCard" class="alert-box">
      <div id="reportContent"></div>
    </div>

    <div class="canvas-container">
      <canvas id="simCanvas" width="900" height="500"></canvas>
      <div class="legend">
        <div class="legend-item"><div class="dot" style="background:#cbd5e1; border:1px dashed #64748b;"></div> åŸè®¾ç½®</div>
        <div class="legend-item"><div class="dot" style="background:#0f172a;"></div> æ–°è®¾ç½®</div>
      </div>
    </div>
  </div>

  <script>
    // === åŸºç¡€é…ç½® ===
    const FIX_REACH = 70, FIX_DROP = 125;
    const CANVAS_BASE = { width: 900, height: 500, scale: 2.5, originX: 200, originY: 450 };
    const canvasState = { width: 900, height: 500 };

    const dom = {
      select: document.getElementById('productSelect'),
      inputs: document.querySelectorAll('input'),
      canvas: document.getElementById('simCanvas'),
      report: document.getElementById('reportCard'),
      reportContent: document.getElementById('reportContent'),
      specDetail: document.getElementById('specDetail'),
      specText: document.getElementById('specText'),
      newStemLen: document.getElementById('newStemLen'),
      newStemAng: document.getElementById('newStemAng'),
      newReach: document.getElementById('newReach'),
      newRise: document.getElementById('newRise'),
      newSpacer: document.getElementById('newSpacer'),
      tags: {
        len: document.getElementById('tagLen'),
        ang: document.getElementById('tagAng'),
        reach: document.getElementById('tagReach')
      }
    };

    const myProducts = [
      { name: "è¯·é€‰æ‹©è§„æ ¼...", value: "none" },
      { name: "æ°´å¹³87 (Ang 14.8Â°)",  stemLen: 102.4, stemAng: 14.8, reach: FIX_REACH, drop: FIX_DROP, rise: 8 },
      { name: "æ°´å¹³100 (Ang 11.4Â°)", stemLen: 113.6, stemAng: 11.4, reach: FIX_REACH, drop: FIX_DROP, rise: 8 },
      { name: "æ°´å¹³110 (Ang 9.2Â°)",  stemLen: 122.8, stemAng: 9.2,  reach: FIX_REACH, drop: FIX_DROP, rise: 8 },
      { name: "æ°´å¹³120 (Ang 7.2Â°)",  stemLen: 131.6, stemAng: 7.2,  reach: FIX_REACH, drop: FIX_DROP, rise: 8 },
      { name: "æ°´å¹³130 (Ang 5.56Â°)", stemLen: 140.7, stemAng: 5.56, reach: FIX_REACH, drop: FIX_DROP, rise: 8 },
      { name: "---", value: "none" },
      { name: "ğŸ› ï¸ è‡ªå®šä¹‰æ¨¡å¼", value: "custom", stemLen: 100, stemAng: -6, reach: 75, drop: 125, rise: 8 }
    ];

    function init() {
      resizeCanvas();
      window.addEventListener('resize', () => { resizeCanvas(); calculate(); });

      myProducts.forEach((p, i) => {
        const opt = document.createElement('option');
        opt.text = p.name;
        opt.value = i;
        if (p.value === 'none' && i !== 0) opt.disabled = true;
        dom.select.add(opt);
      });

      dom.select.addEventListener('change', onSelect);
      dom.inputs.forEach(el => el.addEventListener('input', calculate));

      dom.select.value = 1;
      dom.select.dispatchEvent(new Event('change'));
    }

    function onSelect(e) {
      const idx = e.target.value;
      const p = myProducts[idx];
      if (!p || p.value === 'none') return;

      const isCustom = (p.value === 'custom');
      toggleLock(!isCustom);

      if (isCustom) {
        dom.specDetail.style.display = 'none';
        dom.newStemLen.value = 100;
        dom.newStemAng.value = -6;
        dom.newReach.value = 75;
        dom.newRise.value = 8;
      } else {
        dom.specDetail.style.display = 'block';
        dom.specText.innerHTML = `ç‰©ç†é•¿: ${p.stemLen}mm | ç‰©ç†è§’: ${p.stemAng}Â° | <span style="color:#059669">Hood Rise: +${p.rise}mm</span>`;
        dom.newStemLen.value = p.stemLen;
        dom.newStemAng.value = p.stemAng;
        dom.newReach.value = p.reach;
        dom.newRise.value = p.rise;
      }

      calculate();
    }

    function toggleLock(isLocked) {
      ['newStemLen', 'newStemAng', 'newReach'].forEach(id => {
        const el = document.getElementById(id);
        el.readOnly = isLocked;
        el.className = isLocked ? 'locked-input' : 'editable-input';
      });

      const txt = isLocked ? 'å›ºå®š' : 'è‡ªå®šä¹‰';
      const cls = isLocked ? 'tag-fix' : 'tag-edit';
      Object.values(dom.tags).forEach(t => {
        t.innerText = txt;
        t.className = `tag ${cls}`;
      });
    }

    function calculate() {
      if (dom.newStemLen.value === "") return;

      const hta = parseFloat(document.getElementById('hta').value) || 73;

      const data = {
        hta: hta,
        old: {
          spacer: parseFloat(document.getElementById('oldSpacer').value) || 0,
          len: parseFloat(document.getElementById('oldStemLen').value) || 100,
          ang: parseFloat(document.getElementById('oldStemAng').value) || -6,
          reach: parseFloat(document.getElementById('oldReach').value) || 80,
          drop: 125,
          rise: 0
        },
        new: {
          spacer: parseFloat(dom.newSpacer.value) || 0,
          len: parseFloat(dom.newStemLen.value),
          ang: parseFloat(dom.newStemAng.value),
          reach: parseFloat(dom.newReach.value),
          drop: FIX_DROP,
          rise: parseFloat(dom.newRise.value) || 0
        }
      };

      const p1 = getGeo(data.old, hta);
      const p2 = getGeo(data.new, hta);

      // éªŒè¯ï¼šstem æœ¬ä½“å¯¹åœ°å‚ç›´åˆ†é‡ï¼ˆç”¨äºåŒ¹é…â€œæ ‡ç§° 54mmâ€ï¼‰
      const rad = Math.PI / 180;
      const baseRiseDeg = 90 - hta;
      const absStemRad = (baseRiseDeg + data.new.ang) * rad;
      const stemPureStack = data.new.len * Math.sin(absStemRad);

      renderReport(p2.x - p1.x, p2.y - p1.y, data.new.spacer - data.old.spacer, data, stemPureStack);
      draw(p1, p2, hta);
    }

    // âœ… æ ¸å¿ƒä¿®æ­£ï¼šSpacer æ²¿ HTA(è½¬å‘ç®¡è½´çº¿) æŠ•å½±ï¼›Stem ä»ç”¨ (90-HTA)+stemAng
    function getGeo(d, hta) {
      const rad = Math.PI / 180;

      // 0Â°æŠŠç«‹åŸºå‡†å¯¹åœ°è§’åº¦ï¼ˆä¸è½¬å‘ç®¡è½´çº¿å‚ç›´ï¼‰
      const baseStemDeg = 90 - hta;

      // æŠŠç«‹è½´çº¿å¯¹åœ°ç»å¯¹è§’
      const absStemDeg = baseStemDeg + d.ang;

      // âœ… Spacerï¼šæ²¿è½¬å‘ç®¡è½´çº¿ï¼ˆHTAï¼‰
      const spX = -d.spacer * Math.cos(hta * rad); // å‘å
      const spY =  d.spacer * Math.sin(hta * rad); // å‘ä¸Š

      // Stemï¼šæ²¿æŠŠç«‹è½´çº¿
      const stX = d.len * Math.cos(absStemDeg * rad);
      const stY = d.len * Math.sin(absStemDeg * rad);

      return {
        x: spX + stX + d.reach,
        y: spY + stY + d.rise,
        spX, spY, stX, stY,
        drop: d.drop,
        rise: d.rise
      };
    }

    function renderReport(dR, dS, dSpacer, data, stemPureStack) {
      dom.report.style.display = 'block';

      const reachDiff = parseFloat(dR.toFixed(1));
      const stackDiff = parseFloat(dS.toFixed(1));

      // === æ–°æ‰‹æœ€ç›´ç™½ï¼ˆæ— éšå–»ï¼‰ä¸»å¥ ===
      const r = Math.round(Math.abs(reachDiff));
      const s = Math.round(Math.abs(stackDiff));

      const reachTxt = (r === 0) ? "æŠŠæ‰‹è·ç¦»ä¸å˜" : (reachDiff >= 0 ? `æŠŠæ‰‹æ›´è¿œ ${r}mm` : `æŠŠæ‰‹æ›´è¿‘ ${r}mm`);
      const stackTxt = (s === 0) ? "é«˜åº¦ä¸å˜" : (stackDiff >= 0 ? `æ›´é«˜ ${s}mm` : `æ›´ä½ ${s}mm`);

      let feelTxt = "éª‘å§¿å˜åŒ–ä¸å¤§";
      if (s !== 0) feelTxt = (stackDiff >= 0) ? "æ›´ç›´æ›´è½»æ¾" : "æ›´è¶´æ›´æ¿€è¿›";

      let msg = `${reachTxt}ï¼Œ${stackTxt}ï¼›${feelTxt}ã€‚`;
      let msgExtra = "";

      const isMatch54 = Math.abs(stemPureStack - 54) < 1.0;

      // çŠ¶æ€ï¼ˆä¸æŠ¢ä¸»å¥ï¼šä¸»å¥æ°¸è¿œæ˜¾ç¤ºï¼›é¢å¤–æç¤ºæ”¾ç¬¬äºŒè¡Œï¼‰
      let status = { color: 'green', title: 'âœ… ç»“æœå·²è®¡ç®—', class: 'alert-success' };

      if (dSpacer > 5) {
        status = { color: 'red', title: 'ğŸ›‘ æ³¨æ„ï¼šå«åœˆå˜åŒ–è¾ƒå¤§', class: 'alert-danger' };
        msgExtra = `æ¨¡æ‹Ÿå¢åŠ äº† <b>${dSpacer}mm</b> å«åœˆã€‚`;
      } else if (!isMatch54 && Math.abs(data.hta - 73) > 0.5) {
        status = { color: 'orange', title: 'âš ï¸ æç¤ºï¼šå¤´ç®¡è§’ä¼šå½±å“æ ‡ç§°å †é«˜', class: 'alert-warning' };
        msgExtra = `å¤´ç®¡è§’åº¦ä¸º ${data.hta}Â°ï¼ŒæŠŠç«‹æœ¬ä½“å‚ç›´åˆ†é‡ä¸º ${stemPureStack.toFixed(1)}mmï¼ˆæ ‡ç§° 54mm ä¼šæœ‰åå·®ï¼‰ã€‚`;
      }

      const mathHtml = generateMathDetails(data, stemPureStack);

      dom.report.className = `alert-box ${status.class}`;
      dom.reportContent.innerHTML = `
        <div style="font-weight:800; font-size:1.2em; color:${status.color==='red' ? '#991b1b' : (status.color==='orange' ? '#9a3412' : '#065f46')}; margin-bottom:10px;">
          ${status.title}
        </div>

        <div class="metric-row">
          <div>
            <div class="metric-val"><span class="metric-icon">${reachDiff>=0 ? "â®•" : "â¬…"}</span> ${Math.abs(reachDiff)}</div>
            <div class="metric-lbl">${reachDiff>=0 ? "å‰ä¼¸ (Longer)" : "ç¼©çŸ­ (Shorter)"}</div>
          </div>
          <div style="width:1px; background:#ccc;"></div>
          <div>
            <div class="metric-val"><span class="metric-icon">${stackDiff>=0 ? "â¬†" : "â¬‡"}</span> ${Math.abs(stackDiff)}</div>
            <div class="metric-lbl">${stackDiff>=0 ? "å‡é«˜ (Higher)" : "é™ä½ (Lower)"}</div>
          </div>
        </div>

        <div style="font-size:0.95em; color:#334155; text-align:center;">
          ${msg}
          ${msgExtra ? `<br><span style="font-size:0.85em; color:#64748b;">${msgExtra}</span>` : ``}
        </div>

        <div class="explain-box">
          <div class="explain-title"><span style="font-size:1.2em">ğŸ“</span> å‡ ä½•éªŒè¯</div>
          <div style="font-size:0.9em; color:#475569;">
            è®¡ç®—å‡ºçš„æŠŠç«‹ç‰©ç†å †é«˜: <b style="color:${isMatch54 ? '#059669' : '#ef4444'}">${stemPureStack.toFixed(1)}mm</b>
            <br><span style="font-size:0.85em; color:#64748b;">(å‚å®¶æ ‡ç§°å€¼: 54mm)</span>
          </div>
        </div>

        ${mathHtml}
      `;
    }

    function generateMathDetails(d, stemStack) {
      const rad = Math.PI / 180;
      const baseRise = 90 - d.hta;
      const newAbs = baseRise + d.new.ang;
      const f = (n) => n.toFixed(1);

      return `
        <details class="math-details">
          <summary>è¯¦ç»†æ•°å­¦è§£æï¼šä¸ºä½•æ˜¯ 54mmï¼Ÿ(ä¿®æ­£ç®—æ³•)</summary>
          <div class="math-content">
            <div class="math-block">
              <div class="math-h">è§’åº¦å®šä¹‰ï¼šæŠŠç«‹è§’åº¦å åŠ </div>
              <div class="math-desc">
                å¯¹äºå¤´ç®¡è§’ HTA=${d.hta}Â°ï¼ŒæŠŠç«‹ 0Â° çš„å¯¹åœ°ä¸Šæ‰¬ä¸ºï¼š<b>(90Â° - HTA)</b>ã€‚<br>
                æŠŠç«‹æ ‡ç§°è§’åº¦ <b>Ang=${d.new.ang}Â°</b>ï¼Œè¡¨ç¤ºåœ¨è¯¥åŸºå‡†ä¸Šç»§ç»­ä¸Šæ‰¬/ä¸‹å‹ã€‚
              </div>
            </div>
            <div class="math-block">
              <div class="math-h">è®¡ç®—è¿‡ç¨‹ (HTA ${d.hta}Â°)</div>
              <div class="math-desc">
                1. æŠŠç«‹ 0Â° åŸºå‡†å¯¹åœ°è§’: 90Â° - ${d.hta}Â° = <b>+${f(baseRise)}Â°</b><br>
                2. æŠŠç«‹è½´çº¿å¯¹åœ°è§’: ${f(baseRise)}Â° + ${d.new.ang}Â° = <b style="color:#059669">+${f(newAbs)}Â°</b><br>
                3. å‚ç›´æŠ¬å‡ = ç‰©ç†é•¿åº¦(${d.new.len}) Ã— sin(${f(newAbs)}Â°)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;= ${d.new.len} Ã— ${Math.sin(newAbs*rad).toFixed(4)} â‰ˆ <b style="font-size:1.1em">${f(stemStack)}mm</b>
              </div>
              <div class="math-note">
                è¯¥å€¼ç”¨äºéªŒè¯â€œæŠŠç«‹æœ¬ä½“â€çš„å †é«˜æ ‡ç§°ï¼ˆä¸å«å«åœˆ/æŠŠæ¨ªå‡ ä½•ï¼‰ã€‚
              </div>
            </div>
          </div>
        </details>
      `;
    }

    function resizeCanvas() {
      const rect = dom.canvas.getBoundingClientRect();
      const w = rect.width || CANVAS_BASE.width;
      const h = Math.round(w * (500 / 900));
      const dpr = window.devicePixelRatio || 1;

      dom.canvas.style.height = `${h}px`;
      dom.canvas.width = Math.round(w * dpr);
      dom.canvas.height = Math.round(h * dpr);
      dom.canvas.getContext('2d').setTransform(dpr, 0, 0, dpr, 0, 0);

      canvasState.width = w;
      canvasState.height = h;
    }

    // === ç»˜å›¾é€»è¾‘ ===
    function draw(p1, p2, hta) {
      const ctx = dom.canvas.getContext('2d');
      const w = canvasState.width, h = canvasState.height;
      ctx.clearRect(0, 0, w, h);

      // ç½‘æ ¼
      ctx.strokeStyle = "#f1f5f9";
      ctx.lineWidth = 1;
      ctx.beginPath();
      const step = Math.max(18, Math.round(25 * (w / 900)));
      for (let x = 0; x < w; x += step) { ctx.moveTo(x, 0); ctx.lineTo(x, h); }
      for (let y = 0; y < h; y += step) { ctx.moveTo(0, y); ctx.lineTo(w, y); }
      ctx.stroke();

      const ws = w / 900;
      const sc = 2.5 * ws;
      const ox = 200 * ws;
      const oy = 450 * (h / 500);

      // åœ°é¢çº¿
      ctx.strokeStyle = "#e2e8f0";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(0, oy);
      ctx.lineTo(w, oy);
      ctx.stroke();

      ctx.save();
      ctx.translate(ox, oy);
      ctx.scale(sc, -sc);

      drawRef(ctx, hta);
      drawPart(ctx, p1, "#64748b", true);
      drawPart(ctx, p2, "#0f172a", false);

      ctx.restore();
      dom.canvas.parentElement.style.display = 'block';
    }

    function drawRef(ctx, hta) {
      const rad = Math.PI / 180;

      const steererAxisAng = (180 - hta) * rad; // 73Â° => 107Â°ï¼ˆå‘ä¸Šåå·¦ï¼‰
      const baseStemAng = (90 - hta) * rad;     // 73Â° => 17Â°ï¼ˆå‘å‰åä¸Šï¼‰

      ctx.save();

      // å¤´ç®¡ï¼ˆä»åŸç‚¹å¾€ä¸‹ç”»ï¼‰
      ctx.strokeStyle = "#94a3b8";
      ctx.lineWidth = 14;
      ctx.lineCap = "butt";
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(-Math.cos(steererAxisAng) * 80, -Math.sin(steererAxisAng) * 80);
      ctx.stroke();

      // æŠŠç«‹0Â°åŸºå‡†çº¿ï¼ˆè™šçº¿ï¼‰
      ctx.strokeStyle = "#ef4444";
      ctx.lineWidth = 1;
      ctx.setLineDash([6, 3]);
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(Math.cos(baseStemAng) * 220, Math.sin(baseStemAng) * 220);
      ctx.stroke();

      ctx.restore();
    }

    function drawPart(ctx, p, col, isG) {
      ctx.save();
      ctx.strokeStyle = col;
      ctx.fillStyle = col;
      ctx.lineWidth = isG ? 1 : 2;

      if (isG) {
        ctx.setLineDash([5, 3]);
        ctx.globalAlpha = 0.4;
      } else {
        ctx.setLineDash([]);
        ctx.globalAlpha = 1.0;
        ctx.shadowColor = "rgba(0,0,0,0.2)";
        ctx.shadowBlur = 10;
        ctx.shadowOffsetY = 5;
      }

      // 1. å«åœˆ
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(p.spX, p.spY);
      ctx.lineCap = "butt";
      ctx.lineWidth = 10;
      ctx.stroke();

      // 2. æŠŠç«‹
      ctx.beginPath();
      ctx.moveTo(p.spX, p.spY);
      ctx.lineTo(p.spX + p.stX, p.spY + p.stY);
      ctx.lineWidth = 8;
      ctx.stroke();

      // 3. è½¦æŠŠ/å¼¯æŠŠåˆ° hood ç‚¹
      const bx = p.x, by = p.y;
      ctx.lineWidth = 5;
      ctx.lineCap = "round";
      ctx.lineJoin = "round";

      ctx.beginPath();
      ctx.moveTo(p.spX + p.stX, p.spY + p.stY);
      ctx.lineTo(bx, by);

      const c1x = bx + 30, c1y = by,
            c2x = bx + 30, c2y = by - p.drop,
            ex  = bx - 10, ey  = by - p.drop;

      ctx.bezierCurveTo(c1x, c1y, c2x, c2y, ex, ey);
      ctx.stroke();

      // æ‰‹å˜ç‚¹
      ctx.fillStyle = isG ? "#94a3b8" : "#fff";
      ctx.beginPath();
      ctx.arc(bx, by, isG ? 2 : 3, 0, Math.PI * 2);
      ctx.fill();
      if (!isG) ctx.stroke();

      ctx.restore();
    }

    init();
  </script>
</body>
</html>
